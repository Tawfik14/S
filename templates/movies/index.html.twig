{% extends 'base.html.twig' %}
{% block title %}Films — MovieNight{% endblock %}

{% block stylesheets %}{{ parent() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
{% endblock %}

{% block body %}
<div class="space-y-10">

  {# ===== HERO : Tendances ===== #}
  <section>
    <div class="flex items-end justify-between mb-3">
      <h1 class="text-2xl sm:text-3xl font-extrabold">Tendances</h1>
      <span class="text-sm text-neutral-400 hidden sm:inline">{{ trending|length }} titres</span>
    </div>

    <div class="swiper mv-hero">
      <div class="swiper-wrapper">
        {% for m in trending %}
          {% set title = m.title ?? m.name %}
          {% set slug = title|slug %}
          <a class="swiper-slide group" href="{{ path('app_movie_show', { id: m.id, slug: slug }) }}">
            <div class="aspect-[16/9] overflow-hidden rounded-2xl ring-1 ring-white/10 bg-neutral-900">
              <img src="{{ img.img(m.backdrop_path ?: m.poster_path, 'w780') }}" alt="{{ title }}"
                   class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
            </div>
            <div class="mt-2">
              <div class="font-semibold line-clamp-1">{{ title }}</div>
              <div class="text-sm text-neutral-400">
                {% if m.release_date %}{{ m.release_date|date('Y') }}{% endif %}
                {% if m.vote_average %} • TMDB {{ m.vote_average|number_format(1, ',', ' ') }}/10{% endif %}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </section>

  {# ===== Rangées (posters) ===== #}
  {% set rows = {
    'Populaires'     : popular,
    'Mieux notés'    : topRated,
    'À venir'        : upcoming
  } %}

  {% for label, items in rows %}
    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold">{{ label }}</h2>
        <span class="text-sm text-neutral-400">{{ items|length }} titres</span>
      </div>

      <div class="swiper mv-row">
        <div class="swiper-wrapper">
          {% for m in items %}
            {% set title = m.title ?? m.name %}
            {% set slug = title|slug %}
            <a class="swiper-slide group" href="{{ path('app_movie_show', { id: m.id, slug: slug }) }}">
              <div class="aspect-[2/3] overflow-hidden rounded-xl ring-1 ring-white/10 bg-neutral-900">
                <img src="{{ img.img(m.poster_path, 'w342') }}" alt="{{ title }}"
                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
              </div>
              <div class="mt-2 text-sm font-medium truncate">{{ title }}</div>
              <div class="text-xs text-neutral-400">
                {% if m.release_date %}{{ m.release_date|date('Y') }}{% endif %}
                {% if m.vote_average %} • {{ m.vote_average|number_format(1, ',', ' ') }}/10{% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
        <div class="swiper-scrollbar"></div>
      </div>
    </section>
  {% endfor %}

</div>
{% endblock %}

{% block javascripts %}{{ parent() }}
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
  // Hero
  new Swiper('.swiper.mv-hero', {
    slidesPerView: 1.1,
    spaceBetween: 16,
    centeredSlides: true,
    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
    breakpoints: { 640:{slidesPerView:1.5}, 1024:{slidesPerView:2.2} }
  });

  // Rows
  document.querySelectorAll('.swiper.mv-row').forEach(el=>{
    new Swiper(el, {
      slidesPerView: 3.2,
      spaceBetween: 12,
      scrollbar: { el: el.querySelector('.swiper-scrollbar'), draggable: true },
      breakpoints: {
        480:{slidesPerView:4.2, spaceBetween:12},
        640:{slidesPerView:5.5, spaceBetween:14},
        1024:{slidesPerView:7.5, spaceBetween:16}
      }
    });
  });
</script>
{% endblock %}

