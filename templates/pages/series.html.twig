{% extends 'base.html.twig' %}
{% block title %}Séries — MovieNight{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
{% endblock %}

{% block body %}
<div class="space-y-10">
  {# ===== HERO : séries en cours de diffusion ===== #}
  <section>
    <div class="flex items-end justify-between mb-3">
      <h1 class="text-2xl sm:text-3xl font-extrabold">Séries — En cours de diffusion</h1>
      <span class="text-sm text-neutral-400 hidden sm:inline">{{ hero|length }} titres</span>
    </div>

    <div class="swiper tv-hero">
      <div class="swiper-wrapper">
        {% for s in hero %}
          {% set title = s.name %}
          {% set slug = title|slug %}
          <a class="swiper-slide group" href="{{ path('app_tv_show', { id: s.id, slug: slug }) }}">
            <div class="aspect-[16/9] overflow-hidden rounded-2xl ring-1 ring-white/10 bg-neutral-900">
              <img src="{{ img.img(s.backdrop_path ?: s.poster_path, 'w780') }}" alt="{{ title }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
            </div>
            <div class="mt-2">
              <div class="font-semibold line-clamp-1">{{ title }}</div>
              <div class="text-sm text-neutral-400">
                {% if s.first_air_date %}{{ s.first_air_date|date('Y') }}{% endif %}
                {% if s.vote_average %} • TMDB {{ s.vote_average|number_format(1, ',', ' ') }}/10{% endif %}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </section>

  {# ===== Rangées standard (posters) ===== #}
  {% set rows = {
    'Populaires': popular,
    'Mieux notées': topRated,
    'Diffusées aujourd’hui': airingToday
  } %}

  {% for label, items in rows %}
    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold">{{ label }}</h2>
        <span class="text-sm text-neutral-400">{{ items|length }} titres</span>
      </div>

      <div class="swiper tv-row">
        <div class="swiper-wrapper">
          {% for s in items %}
            {% set title = s.name %}
            {% set slug = title|slug %}
            <a class="swiper-slide group" href="{{ path('app_tv_show', { id: s.id, slug: slug }) }}">
              <div class="aspect-[2/3] overflow-hidden rounded-xl ring-1 ring-white/10 bg-neutral-900">
                <img src="{{ img.img(s.poster_path, 'w342') }}" alt="{{ title }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
              </div>
              <div class="mt-2 text-sm font-medium truncate">{{ title }}</div>
              <div class="text-xs text-neutral-400">
                {% if s.first_air_date %}{{ s.first_air_date|date('Y') }}{% endif %}
                {% if s.vote_average %} • {{ s.vote_average|number_format(1, ',', ' ') }}/10{% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
        <div class="swiper-scrollbar"></div>
      </div>
    </section>
  {% endfor %}

  {# ===== Par genres (carrousels) ===== #}
  {% for genreName, list in byGenres %}
    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold">{{ genreName }}</h2>
        <span class="text-sm text-neutral-400">{{ list|length }} titres</span>
      </div>

      <div class="swiper tv-row">
        <div class="swiper-wrapper">
          {% for s in list %}
            {% set title = s.name %}
            {% set slug = title|slug %}
            <a class="swiper-slide group" href="{{ path('app_tv_show', { id: s.id, slug: slug }) }}">
              <div class="aspect-[2/3] overflow-hidden rounded-xl ring-1 ring-white/10 bg-neutral-900">
                <img src="{{ img.img(s.poster_path, 'w342') }}" alt="{{ title }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
              </div>
              <div class="mt-2 text-sm font-medium truncate">{{ title }}</div>
              <div class="text-xs text-neutral-400">
                {% if s.first_air_date %}{{ s.first_air_date|date('Y') }}{% endif %}
                {% if s.vote_average %} • {{ s.vote_average|number_format(1, ',', ' ') }}/10{% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
        <div class="swiper-scrollbar"></div>
      </div>
    </section>
  {% endfor %}
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    // Hero large
    new Swiper('.swiper.tv-hero', {
      slidesPerView: 1.1,
      spaceBetween: 16,
      centeredSlides: true,
      navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
      breakpoints: {
        640:  { slidesPerView: 1.5 },
        1024: { slidesPerView: 2.2 },
      }
    });

    // Rangées posters
    document.querySelectorAll('.swiper.tv-row').forEach(el => {
      new Swiper(el, {
        slidesPerView: 3.2,
        spaceBetween: 12,
        scrollbar: { el: el.querySelector('.swiper-scrollbar'), draggable: true },
        breakpoints: {
          480:  { slidesPerView: 4.2, spaceBetween: 12 },
          640:  { slidesPerView: 5.5, spaceBetween: 14 },
          1024: { slidesPerView: 7.5, spaceBetween: 16 },
        }
      });
    });
  </script>
{% endblock %}

