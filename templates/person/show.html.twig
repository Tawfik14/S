{% extends 'base.html.twig' %}
{% block title %}{{ p.name }} — Fiche{% endblock %}

{% block body %}
<section class="space-y-10">
  <!-- Header -->
  <div class="rounded-2xl ring-1 ring-white/10 bg-gradient-to-r from-rose-600/20 via-fuchsia-600/10 to-transparent p-6 sm:p-8">
    <div class="flex gap-6">
      <div class="w-32 h-32 sm:w-40 sm:h-40 rounded-2xl overflow-hidden ring-1 ring-white/10 bg-neutral-900 shrink-0">
        <img src="{{ p.profile_path ? img.img(p.profile_path, 'w300') : asset('placeholder-avatar.png') }}" alt="{{ p.name }}" class="w-full h-full object-cover">
      </div>
      <div class="min-w-0">
        <h1 class="text-3xl sm:text-4xl font-extrabold">{{ p.name }}</h1>
        <div class="mt-1 text-sm text-neutral-300">
          {% if p.known_for_department %}<span class="px-2 py-0.5 rounded bg-white/10 ring-1 ring-white/10">{{ p.known_for_department }}</span>{% endif %}
          {% if age is not null %}
            <span class="ml-2">• {{ age }} ans</span>
          {% endif %}
        </div>
        <div class="mt-2 text-sm text-neutral-400">
          {% if p.birthday %}Né(e) le {{ p.birthday|date('d/m/Y') }}{% if p.place_of_birth %} à {{ p.place_of_birth }}{% endif %}{% endif %}
          {% if p.deathday %} — Décédé(e) le {{ p.deathday|date('d/m/Y') }}{% endif %}
        </div>

        <!-- Liens sociaux -->
        <div class="mt-3 flex gap-3">
          {% if ext.imdb_id %}
            <a class="text-neutral-300 hover:text-rose-400 underline" href="https://www.imdb.com/name/{{ ext.imdb_id }}/" target="_blank" rel="noopener">IMDb</a>
          {% endif %}
          {% if ext.instagram_id %}
            <a class="text-neutral-300 hover:text-rose-400 underline" href="https://instagram.com/{{ ext.instagram_id }}" target="_blank" rel="noopener">Instagram</a>
          {% endif %}
          {% if ext.twitter_id %}
            <a class="text-neutral-300 hover:text-rose-400 underline" href="https://twitter.com/{{ ext.twitter_id }}" target="_blank" rel="noopener">Twitter</a>
          {% endif %}
          {% if ext.facebook_id %}
            <a class="text-neutral-300 hover:text-rose-400 underline" href="https://facebook.com/{{ ext.facebook_id }}" target="_blank" rel="noopener">Facebook</a>
          {% endif %}
        </div>
      </div>
    </div>

    {% if p.biography %}
      <div class="mt-6 max-w-3xl">
        <h2 class="text-xl font-semibold">Biographie</h2>
        <p class="mt-2 text-neutral-100 leading-relaxed whitespace-pre-wrap">{{ p.biography }}</p>
      </div>
    {% endif %}
  </div>

  <!-- Connu pour -->
  {% if knownFor is not empty %}
  <section>
    <h2 class="text-xl font-semibold mb-3">Connu pour</h2>
    <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5">
      {% for m in knownFor %}
        {% set title = m.title ?? m.name %}
        {% set slug = title|slug %}
        <a href="{{ path('app_movie_show', { id: m.id, slug: slug }) }}" class="group">
          <div class="aspect-[2/3] rounded-xl overflow-hidden ring-1 ring-white/10 bg-neutral-900">
            <img src="{{ img.img(m.poster_path, 'w342') }}" alt="{{ title }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
          </div>
          <div class="mt-2 text-sm font-medium truncate">{{ title }}</div>
          {% if m.release_date %}<div class="text-xs text-neutral-400">{{ m.release_date|date('Y') }}</div>{% endif %}
        </a>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Filmographie (Interprétation) -->
  {% if cast is not empty %}
  <section>
    <h2 class="text-xl font-semibold mb-3">Filmographie — Interprétation</h2>
    <div class="rounded-2xl ring-1 ring-white/10 bg-neutral-900 overflow-hidden">
      <ul class="divide-y divide-white/10">
        {% for m in cast %}
          {% set title = m.title ?? m.name %}
          {% set slug = title|slug %}
          <li>
            <a href="{{ path('app_movie_show', { id: m.id, slug: slug }) }}" class="flex items-center gap-4 p-3 hover:bg-neutral-800">
              <div class="w-14 h-20 rounded-md overflow-hidden ring-1 ring-white/10 bg-neutral-800 shrink-0">
                <img src="{{ img.img(m.poster_path, 'w185') }}" alt="{{ title }}" class="w-full h-full object-cover">
              </div>
              <div class="min-w-0">
                <div class="font-medium truncate">{{ title }}</div>
                <div class="text-sm text-neutral-400">
                  {{ m.release_date ? m.release_date|date('Y-m-d') : 'Date inconnue' }}
                  {% if m.character %} • Rôle : {{ m.character }}{% endif %}
                </div>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </section>
  {% endif %}

  <!-- Filmographie (Équipe technique) -->
  {% if crew is not empty %}
  <section>
    <h2 class="text-xl font-semibold mb-3">Filmographie — Équipe technique</h2>
    <div class="rounded-2xl ring-1 ring-white/10 bg-neutral-900 overflow-hidden">
      <ul class="divide-y divide-white/10">
        {% for m in crew %}
          {% set title = m.title ?? m.name %}
          {% set slug = title|slug %}
          <li>
            <a href="{{ path('app_movie_show', { id: m.id, slug: slug }) }}" class="flex items-center gap-4 p-3 hover:bg-neutral-800">
              <div class="w-14 h-20 rounded-md overflow-hidden ring-1 ring-white/10 bg-neutral-800 shrink-0">
                <img src="{{ img.img(m.poster_path, 'w185') }}" alt="{{ title }}" class="w-full h-full object-cover">
              </div>
              <div class="min-w-0">
                <div class="font-medium truncate">{{ title }}</div>
                <div class="text-sm text-neutral-400">
                  {{ m.release_date ? m.release_date|date('Y-m-d') : 'Date inconnue' }}
                  {% if m.job %} • {{ m.job }}{% endif %}
                </div>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </section>
  {% endif %}
</section>
{% endblock %}

